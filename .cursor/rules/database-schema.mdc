
# Supabase ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

## ğŸ“Š í…Œì´ë¸” êµ¬ì¡°

### 1. articles (ê¸°ì‚¬) í…Œì´ë¸”
```sql
CREATE TABLE articles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  journalist_id UUID NOT NULL,
  publisher TEXT NOT NULL,
  clickbait_score INTEGER NOT NULL CHECK (clickbait_score >= 0 AND clickbait_score <= 100),
  score_explanation TEXT,
  published_at TIMESTAMP WITH TIME ZONE NOT NULL,
  naver_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 3. batch (OpenAI ë°°ì¹˜ ì‘ì—…) í…Œì´ë¸”
```sql
CREATE TABLE batch (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  batch_id TEXT NOT NULL UNIQUE,
  status TEXT NOT NULL CHECK (status IN ('in_progress', 'completed', 'failed', 'cancelled')),
  article_count INTEGER NOT NULL DEFAULT 0,
  error_message TEXT,
  input_file_id TEXT,
  output_file_id TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 2. journalists (ê¸°ì) í…Œì´ë¸”  
```sql
CREATE TABLE journalists (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  naver_uuid TEXT,
  publisher TEXT NOT NULL,
  article_count INTEGER DEFAULT 0,
  average_score DECIMAL(5,2) DEFAULT 0.00,
  max_score INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## ğŸ” ì¸ë±ìŠ¤ ì„¤ì •

### ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ì¸ë±ìŠ¤
```sql
-- ê¸°ì‚¬ í…Œì´ë¸” ì¸ë±ìŠ¤
CREATE INDEX idx_articles_clickbait_score ON articles (clickbait_score DESC);
CREATE INDEX idx_articles_published_at ON articles (published_at DESC);
CREATE INDEX idx_articles_journalist_id ON articles (journalist_id);
CREATE INDEX idx_articles_title_gin ON articles USING GIN (to_tsvector('english', title));
CREATE INDEX idx_articles_publisher ON articles (publisher);

-- ê¸°ì í…Œì´ë¸” ì¸ë±ìŠ¤
CREATE INDEX idx_journalists_average_score ON journalists (average_score DESC);
CREATE INDEX idx_journalists_publisher ON journalists (publisher);
```

## ğŸ”§ ìë™í™” ê¸°ëŠ¥

### ê¸°ì í†µê³„ ìë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
```sql
CREATE OR REPLACE FUNCTION update_journalist_stats()
RETURNS TRIGGER AS $$
BEGIN
  UPDATE journalists 
  SET 
    article_count = (
      SELECT COUNT(*) FROM articles WHERE journalist_id = NEW.journalist_id
    ),
    average_score = (
      SELECT AVG(clickbait_score) FROM articles WHERE journalist_id = NEW.journalist_id
    ),
    max_score = (
      SELECT MAX(clickbait_score) FROM articles WHERE journalist_id = NEW.journalist_id
    ),
    updated_at = NOW()
  WHERE id = NEW.journalist_id;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_journalist_stats
AFTER INSERT OR UPDATE ON articles
FOR EACH ROW
EXECUTE FUNCTION update_journalist_stats();
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™” ë·°

### ì¸ê¸° ê¸°ì‚¬ ë·° (ë‚šì‹œ ì ìˆ˜ 70ì  ì´ìƒ)
```sql
CREATE VIEW popular_articles AS
SELECT 
  id,
  title,
  clickbait_score,
  published_at,
  naver_url,
  journalist_id,
  publisher
FROM articles
WHERE clickbait_score >= 70
ORDER BY clickbait_score DESC;
```

### ê¸°ì ë­í‚¹ ë·°
```sql
CREATE VIEW journalist_rankings AS
SELECT 
  j.id,
  j.name,
  j.publisher,
  j.article_count,
  j.average_score,
  j.max_score,
  j.created_at,
  j.updated_at
FROM journalists j
WHERE j.article_count > 0
ORDER BY j.average_score DESC;
```

## ğŸ”’ ë³´ì•ˆ ì •ì±… (RLS)

### Row Level Security ì„¤ì •
```sql
-- ê¸°ì‚¬ í…Œì´ë¸” ê³µê°œ ì½ê¸° ê¶Œí•œ
ALTER TABLE articles ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Articles are viewable by everyone" ON articles
  FOR SELECT USING (true);

-- ê¸°ì í…Œì´ë¸” ê³µê°œ ì½ê¸° ê¶Œí•œ  
ALTER TABLE journalists ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Journalists are viewable by everyone" ON journalists
  FOR SELECT USING (true);
```

## ğŸ“Š TypeScript íƒ€ì… ì •ì˜

### ê¸°ë³¸ íƒ€ì…
```typescript
export interface Article {
  id: string;
  title: string;
  content: string;
  journalist_id: string;
  publisher: string;
  clickbait_score: number;
  score_explanation?: string;
  published_at: string;
  naver_url?: string;
  created_at: string;
  updated_at: string;
}

export interface Journalist {
  id: string;
  name: string;
  naver_uuid?: string;
  publisher: string;
  article_count: number;
  average_score: number;
  max_score: number;
  created_at: string;
  updated_at: string;
}
```

### í™•ì¥ íƒ€ì… (ì¡°ì¸ í¬í•¨)
```typescript
export interface ArticleWithJournalist extends Article {
  journalist: {
    name: string;
    publisher: string;
  };
}

export interface JournalistRanking {
  id: string;
  name: string;
  publisher: string;
  article_count: number;
  average_score: number;
  max_score: number;
  created_at: string;
  updated_at: string;
}
```

## ğŸ” ì£¼ìš” ì¿¼ë¦¬ íŒ¨í„´

### 1. ê¸°ì‚¬ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
```sql
SELECT 
  a.id,
  a.title,
  a.clickbait_score,
  a.published_at,
  a.naver_url,
  j.name as journalist_name,
  a.publisher
FROM articles a
JOIN journalists j ON a.journalist_id = j.id
ORDER BY a.published_at DESC
LIMIT 20 OFFSET 0;
```

### 2. ê¸°ìë³„ ê¸°ì‚¬ ì¡°íšŒ
```sql
SELECT 
  a.id,
  a.title,
  a.clickbait_score,
  a.published_at,
  a.naver_url,
  a.publisher
FROM articles a
WHERE a.journalist_id = $1
ORDER BY a.published_at DESC;
```

### 3. ì‹ ë¬¸ì‚¬ë³„ ê¸°ì‚¬ ì¡°íšŒ
```sql
SELECT 
  a.id,
  a.title,
  a.clickbait_score,
  a.published_at,
  a.naver_url,
  j.name as journalist_name
FROM articles a
JOIN journalists j ON a.journalist_id = j.id
WHERE a.publisher = $1
ORDER BY a.published_at DESC;
```

### 4. ì¸ê¸° ê¸°ì‚¬ ì¡°íšŒ (ë‚šì‹œ ì ìˆ˜ ë†’ì€ ìˆœ)
```sql
SELECT * FROM popular_articles
LIMIT 10;
```

### 5. ê¸°ì ë­í‚¹ ì¡°íšŒ
```sql
SELECT * FROM journalist_rankings
LIMIT 20;
```

### 6. ì‹ ë¬¸ì‚¬ë³„ ê¸°ì ë­í‚¹
```sql
SELECT * FROM journalist_rankings
WHERE publisher = $1
LIMIT 10;
```

## ğŸ“¦ Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜
```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

### í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
```typescript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

## ğŸ¯ ë‚šì‹œ ì ìˆ˜ ì‹œìŠ¤í…œ

### ì ìˆ˜ ë²”ìœ„ ë° ìƒ‰ìƒ
- **0-30ì **: ë‚®ìŒ (Green) `#10B981`
- **31-60ì **: ë³´í†µ (Yellow) `#F59E0B`  
- **61-100ì **: ë†’ìŒ (Red) `#EF4444`

### ì ìˆ˜ ìƒ‰ìƒ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
```typescript
export function getScoreColor(score: number): string {
  if (score <= 30) return '#10B981'; // green
  if (score <= 60) return '#F59E0B'; // yellow
  return '#EF4444'; // red
}

export function getScoreTextColor(score: number): string {
  if (score <= 30) return 'text-green-600';
  if (score <= 60) return 'text-yellow-600';
  return 'text-red-600';
}

export function getScoreBgColor(score: number): string {
  if (score <= 30) return 'bg-green-100';
  if (score <= 60) return 'bg-yellow-100';
  return 'bg-red-100';
}
```

## ğŸ“° ì‹ ë¬¸ì‚¬ ëª©ë¡

### í˜„ì¬ ë“±ë¡ëœ ì‹ ë¬¸ì‚¬ë“¤
- **ì¡°ì„ ì¼ë³´** - ëŒ€í‘œì ì¸ ë³´ìˆ˜ ì¼ê°„ì§€
- **ì¤‘ì•™ì¼ë³´** - ì¢…í•© ì¼ê°„ì§€
- **ë™ì•„ì¼ë³´** - ëŒ€í‘œì ì¸ ë³´ìˆ˜ ì¼ê°„ì§€
- **í•œêµ­ì¼ë³´** - ì¢…í•© ì¼ê°„ì§€
- **ë¬¸í™”ì¼ë³´** - ë¬¸í™” ì¤‘ì‹¬ ì¼ê°„ì§€
- **ì„¸ê³„ì¼ë³´** - ì¢…í•© ì¼ê°„ì§€
- **êµ­ë¯¼ì¼ë³´** - ì¢…í•© ì¼ê°„ì§€
- **ì„œìš¸ì‹ ë¬¸** - ìˆ˜ë„ê¶Œ ì¼ê°„ì§€
- **í•œê²¨ë ˆ** - ì§„ë³´ ì„±í–¥ ì¼ê°„ì§€
- **ê²½í–¥ì‹ ë¬¸** - ì§„ë³´ ì„±í–¥ ì¼ê°„ì§€

### ì‹ ë¬¸ì‚¬ë³„ í†µê³„ ì¡°íšŒ
```sql
SELECT 
  publisher,
  COUNT(*) as total_articles,
  AVG(clickbait_score) as avg_clickbait_score,
  MAX(clickbait_score) as max_clickbait_score
FROM articles 
GROUP BY publisher
ORDER BY avg_clickbait_score DESC;
```

  return query;
}
```

  return query;
}
```
